{"ast":null,"code":"var _jsxFileName = \"/Users/yutianjian/test/oda/src/viewer/ViewerPage.js\";\n///////////////////////////////////////////////////////////////////////////////\n// Copyright (C) 2002-2021, Open Design Alliance (the \"Alliance\").\n// All rights reserved.\n//\n// This software and its documentation and related materials are owned by\n// the Alliance. The software may only be incorporated into application\n// programs owned by members of the Alliance, subject to a signed\n// Membership Agreement and Supplemental Software License Agreement with the\n// Alliance. The structure and organization of this software are the valuable\n// trade secrets of the Alliance and its suppliers. The software is also\n// protected by copyright law and international treaty provisions. Application\n// programs incorporating this software must include the following statement\n// with their copyright notices:\n//\n//   This application incorporates Open Design Alliance software pursuant to a\n//   license agreement with Open Design Alliance.\n//   Open Design Alliance Copyright (C) 2002-2021 by Open Design Alliance.\n//   All rights reserved.\n//\n// By use of this software, its documentation or related materials, you\n// acknowledge and accept the above terms.\n///////////////////////////////////////////////////////////////////////////////\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router\";\nimport { actions as notification } from \"../redux/notification\";\nimport { actions } from \"../redux/viewer\";\nimport ProgressBar from \"../components/ProgressBar\";\nimport Header from \"../components/Header\";\nimport UserMenu from \"../containers/UserMenu\";\nimport { VisualizeProgress } from \"./VisualizeJSProgress\";\nimport ClientFactory from \"../ClientFactory\";\nimport ViewPointHelper from \"./ViewPointHelper\";\nimport { DraggerComponent } from \"./DraggerComponent/DraggerComponent\";\nimport { DraggerComponentEvent } from \"./DraggerComponent/DraggerComponentEvent\";\nimport { ViewActionComponentEvent } from \"./ViewActionComponent/ViewActionComponentEvent\";\nimport { ViewActionComponent } from \"./ViewActionComponent/ViewActionComponent\";\nimport { HeaderComponent } from \"./HeaderComponent/HeaderComponent\";\nimport { HeaderComponentEvent } from \"./HeaderComponent/HeaderComponentEvent\";\nimport { ViewpointListEvent } from \"./ViewpointListComponent/ViewpointListEvent\";\nimport { ViewpointListComponent } from \"./ViewpointListComponent/ViewpointListComponent\";\nimport { PropertiesComponent } from \"./PropertiesComponent/PropertiesComponent\";\nimport { PropertiesEvent } from \"./PropertiesComponent/PropertiesEvent\";\nimport { ContextMenu } from \"./ContextMenu/ContextMenu\";\nimport { ContextMenuEvent } from \"./ContextMenu/ContextMenuEvent\";\nimport ObjectExplorer from \"./ObjectExplorer\";\nimport { SubscribeSubjectContext } from \"../utils/SubscribeSubjectContext\";\nimport { ModelContextFactory } from \"./ModelContexts/ModelContextFactory\";\nimport { AssemblyTransformComponent } from \"./AssemblyTransformComponent/AssemblyTransformComponent\";\nimport { WalkHelperComponent } from \"./WalkHelperComponent/WalkHelperComponent\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst defaultState = {\n  modelList: [],\n  activeModel: null,\n  file: null,\n  geometryProgress: 0,\n  visualizeProgress: 0,\n  databaseLoaded: false,\n  isVisibleObjectExplorer: false,\n  isVisibleProperties: false,\n  isVisibleViewPointView: false,\n  isVisibleTransformView: false,\n  geometryLoaded: false,\n  isCDA: false,\n  isLoadIndicatorVisible: false,\n  canvasClassName: \"default-cursor\",\n  activeDraggerName: \"\",\n  isWalkHelperComponent: false\n};\n\nclass Viewer extends Component {\n  constructor(_props) {\n    super(_props);\n    this.state = { ...defaultState\n    };\n    this.isInitialize = null;\n    this.defaultVisualStyle = \"\";\n    this.odaApp = null;\n    this.modelContext = null;\n\n    this.toggle = name => () => this.setState({\n      [name]: !this.state[name]\n    });\n\n    this.resetVisualStyleInformation = () => {\n      this.viewActionEvents.changeDefaultVisualStyle.next(this.odaApp.visViewer().getActiveVisualStyle());\n    };\n\n    this.changeCursorWhenDrag = () => {\n      if (this.state.activeDraggerName === \"Pan\") {\n        this.setState({\n          canvasClassName: \"pan-active-cursor\"\n        });\n      } else if (this.state.activeDraggerName === \"Orbit\") {\n        this.setState({\n          canvasClassName: \"orbit-active-cursor\"\n        });\n      } else {\n        this.setState({\n          canvasClassName: \"default-cursor\"\n        });\n      }\n    };\n\n    this.changeCursorWhenActivateDragger = () => {\n      if (this.state.activeDraggerName === \"Pan\") {\n        this.setState({\n          canvasClassName: \"pan-cursor\"\n        });\n      } else if (this.state.activeDraggerName === \"Orbit\") {\n        this.setState({\n          canvasClassName: \"orbit-cursor\"\n        });\n      } else {\n        this.setState({\n          canvasClassName: \"default-cursor\"\n        });\n      }\n    };\n\n    this.getProperties = async handle => {\n      try {\n        this.propertiesEvents.loadingProperties.next(true);\n        const props = await this.modelContext.getPropertiesByHandle(handle);\n\n        if (this.state.isVisibleProperties) {\n          this.propertiesEvents.completeLoadProperties.next(props);\n          this.lastProperties = null;\n        } else {\n          this.lastProperties = props;\n        }\n      } catch (e) {\n        this.propertiesEvents.loadingProperties.next(\"Not found properties\");\n      }\n    };\n\n    this.openModel = async model => {\n      try {\n        if (this.odaApp) {\n          this.odaApp.cancel();\n          this.odaApp.visViewer().unselect();\n        }\n\n        this.draggerEventsConnection.changeInitialization.next();\n        this.viewActionEvents.changeEnable.next(false);\n        this.headerEventsConnection.changeEnable.next(false);\n        this.draggerEventsConnection.changeSupportViewPoint.next(this.modelContext.isSupportViewPoint());\n        this.headerEventsConnection.changeSupportViewPoint.next(this.modelContext.isSupportViewPoint());\n        this.headerEventsConnection.changeSupportTransform.next(this.modelContext.isSupportTransform());\n        await this.odaApp.loadReferences(model);\n        this.setState({\n          activeModel: model,\n          displayObjectExplorer: false,\n          properties: false,\n          settings: false\n        });\n\n        const progress = event => this.setState({\n          geometryProgress: event.data\n        });\n\n        const databaseChunk = () => {\n          this.setState({\n            databaseLoaded: true\n          });\n          this.draggerEventsConnection.changeEnable.next(true);\n          this.viewActionEvents.changeEnable.next(true);\n          this.headerEventsConnection.changeEnable.next(true);\n          this.resetVisualStyleInformation();\n        };\n\n        this.odaApp.addEventListener(\"geometry-progress\", progress);\n        this.odaApp.addEventListener(\"database-chunk\", databaseChunk);\n        await this.odaApp.open(model);\n        this.odaApp.removeEventListener(\"database-chunk\", databaseChunk);\n        this.odaApp.removeEventListener(\"geometry-progress\", progress);\n        {\n          const itr = this.odaApp.visViewer().getCDATreeIterator();\n          this.headerEventsConnection.changeEnableObjectExplorer.next(!itr.done());\n          this.setState({\n            geometryLoaded: true,\n            isCDA: !itr.done() && ClientFactory.getConfig().cda\n          });\n        }\n        this.odaApp.visViewer().setEnableSceneGraph(true);\n        const extFile = this.modelContext.getExtension();\n        if (extFile === \".obj\" || extFile === \".ifc\") this.odaApp.visViewer().setBackgroundColor([255, 255, 255]);\n        const ext = this.odaApp.visViewer().getActiveExtents();\n        const min = ext.min();\n        const max = ext.max();\n        const extHeight = max[2] - min[2];\n        this.draggerEventsConnection.change3dMode.next(extHeight !== 0);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    this.subscribeSubjectContext = new SubscribeSubjectContext();\n    this.connectDraggerComponentEvents();\n    this.connectViewActionComponentEvents();\n    this.connectHeaderComponentEvents();\n    this.connectViewpointListComponentEvents();\n    this.connectPropertiesEvents();\n  }\n\n  connectPropertiesEvents() {\n    this.propertiesEvents = new PropertiesEvent();\n    this.subscribeSubjectContext.subscribe(this.propertiesEvents.onClose, () => this.toggle(\"isVisibleProperties\")());\n  }\n\n  connectViewpointListComponentEvents() {\n    this.viewpointListEvents = new ViewpointListEvent();\n    this.subscribeSubjectContext.subscribe(this.viewpointListEvents.onClose, () => this.toggle(\"isVisibleViewPointView\")());\n    this.subscribeSubjectContext.subscribe(this.viewpointListEvents.onRemoveViewpoint, async vp => {\n      try {\n        await this.state.activeModel.deleteViewpoint(vp.guid);\n        this.props.addNotification(\"success\", \"Viewpoint deleted successfully\");\n      } catch (e) {\n        this.props.addNotification(\"error\", \"Error delete view point\");\n      }\n    });\n    this.subscribeSubjectContext.subscribe(this.viewpointListEvents.onSelectViewpoint, async vp => {\n      const viewpointModelId = vp.custom_fields && vp.custom_fields.modelId;\n      const viewPointPlugin = new ViewPointHelper(this.odaApp.visLib());\n\n      if (viewpointModelId !== undefined && this.state.activeModel && this.state.activeModel.id !== viewpointModelId) {\n        const model = this.state.modelList.find(model => model.id === viewpointModelId);\n\n        if (model) {\n          try {\n            await this.openModel(model);\n            viewPointPlugin.drawViewPoint(vp);\n          } catch {\n            this.props.addNotification(\"error\", \"Cannot open model\");\n          }\n        }\n      } else {\n        viewPointPlugin.drawViewPoint(vp);\n      }\n    });\n  }\n\n  connectHeaderComponentEvents() {\n    this.headerEventsConnection = new HeaderComponentEvent();\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenModel, model => this.openModel(model));\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenObjectExplorer, () => this.toggle(\"isVisibleObjectExplorer\")());\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenProperties, () => {\n      this.toggle(\"isVisibleProperties\")();\n\n      if (this.lastProperties) {\n        setTimeout(() => {\n          this.propertiesEvents.completeLoadProperties.next(this.lastProperties);\n        }, 0);\n      }\n    });\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenViewpointView, async () => {\n      this.setState({\n        isVisibleViewPointView: true\n      });\n      const viewPoints = await this.state.activeModel.getViewpoints();\n      this.viewpointListEvents.changeViewpoints.next(viewPoints);\n\n      for (let vp of viewPoints) {\n        if (!vp.snapshot) {\n          vp.snapshot = await this.state.activeModel.getSnapshot(vp.guid);\n          this.viewpointListEvents.modifyViewpoint.next(vp);\n        }\n      }\n    });\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenEdit, () => {\n      this.setState({\n        isVisibleTransformView: true\n      });\n    });\n  }\n\n  changeVisibleForHelp() {\n    if (this.state.activeDraggerName === \"Walk\") {\n      this.viewActionEvents.changeEnableHelp.next(true);\n    } else {\n      this.viewActionEvents.changeEnableHelp.next(false);\n    }\n  }\n\n  connectDraggerComponentEvents() {\n    this.draggerEventsConnection = new DraggerComponentEvent();\n    this.subscribeSubjectContext.subscribe(this.draggerEventsConnection.onActivateDraggerByName, draggerName => {\n      this.setState({\n        activeDraggerName: draggerName\n      }, () => {\n        this.changeCursorWhenActivateDragger();\n        this.changeVisibleForHelp();\n      });\n      this.odaApp.setActiveDragger(draggerName);\n    });\n    this.subscribeSubjectContext.subscribe(this.draggerEventsConnection.onClearViewPoint, () => {\n      this.odaApp.clearSlices();\n      this.odaApp.clearOverlay();\n    });\n    this.subscribeSubjectContext.subscribe(this.draggerEventsConnection.onSaveViewPoint, async () => {\n      const viewPointPlugin = new ViewPointHelper(this.odaApp.visLib());\n      const vp = viewPointPlugin.getViewPoint(this.odaApp.visLib().canvas);\n      !vp.custom_fields && (vp.custom_fields = {});\n      this.state.activeModel && (vp.custom_fields.modelId = this.state.activeModel.id);\n      vp.description = new Date().toDateString();\n      let newVp = null;\n\n      try {\n        newVp = await this.state.activeModel.saveViewpoint(vp);\n        this.props.addNotification(\"success\", \"Viewpoint saved successfully\");\n      } catch (e) {\n        this.props.addNotification(\"error\", \"Error save view point\");\n      }\n\n      if (this.state.isVisibleViewPointView && newVp) {\n        if (!newVp.snapshot) {\n          newVp.snapshot = await this.state.activeModel.getSnapshot(newVp.guid);\n        }\n\n        this.viewpointListEvents.addViewpoint.next(newVp);\n      }\n    });\n  }\n\n  connectViewActionComponentEvents() {\n    this.explodeIndex = 1;\n    this.viewActionEvents = new ViewActionComponentEvent();\n    this.contextMenuEvents = new ContextMenuEvent();\n\n    const execWithLoadIndicator = cb => {\n      this.setState({\n        isLoadIndicatorVisible: true\n      }, () => {\n        setTimeout(() => {\n          cb();\n          this.setState({\n            isLoadIndicatorVisible: false\n          });\n        }, 10);\n      });\n    };\n\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onChangeVisualStyle, name => {\n      execWithLoadIndicator(() => this.odaApp.visViewer().setActiveVisualStyle(name));\n    });\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onChangeViewType, type => {\n      const defViewPos = this.odaApp.visLib().DefaultViewPosition;\n      this.odaApp.visViewer().setDefaultViewPositionWithAnimation(defViewPos[type]);\n    });\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onChangeViewToDefaultValue, () => this.odaApp.visViewer().zoomExtents());\n\n    const onUnselect = () => execWithLoadIndicator(() => this.odaApp.visViewer().unselect());\n\n    const onIsolateSelectedObjects = () => execWithLoadIndicator(() => this.odaApp.visViewer().isolateSelectedObjects(false));\n\n    const onHideSelectedObjects = () => execWithLoadIndicator(() => this.odaApp.visViewer().hideSelectedObjects());\n\n    const onShowAll = () => execWithLoadIndicator(() => this.odaApp.visViewer().unisolateSelectedObjects(false));\n\n    const onExplode = () => execWithLoadIndicator(() => {\n      this.explodeIndex++;\n      this.odaApp.visViewer().explode(this.explodeIndex);\n    });\n\n    const onCollect = () => execWithLoadIndicator(() => {\n      this.explodeIndex = 1;\n      this.odaApp.visViewer().explode(1);\n    });\n\n    const onRegeneration = () => execWithLoadIndicator(() => {\n      this.odaApp.visViewer().regenAll();\n    });\n\n    const onCreatePreview = async () => {\n      const canvas = this.odaApp.visLib().canvas;\n      const base64Img = canvas.toDataURL(\"image/jpeg\", 0.25);\n      const item = this.modelContext.get();\n      item.preview = base64Img;\n      item.save();\n      this.props.addNotification(\"success\", \"Update file preview done\");\n    };\n\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onUnselect, onUnselect);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onIsolateSelectedObjects, onIsolateSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onHideSelectedObjects, onHideSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onShowAll, onShowAll);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onExplode, onExplode);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onCollect, onCollect);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onRegeneration, onRegeneration);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onCreatePreview, onCreatePreview);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onUnselect, onUnselect);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onIsolateSelectedObjects, onIsolateSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onHideSelectedObjects, onHideSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onShowAll, onShowAll);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onExplode, onExplode);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onCollect, onCollect);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onRegeneration, onRegeneration);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onCreatePreview, onCreatePreview);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onHelp, () => {\n      this.setState({\n        isWalkHelperComponent: true\n      });\n    });\n  }\n\n  async componentDidMount() {\n    const canvas = document.getElementById(\"canvas\");\n    canvas.addEventListener(\"mousedown\", this.changeCursorWhenDrag);\n    canvas.addEventListener(\"mouseup\", this.changeCursorWhenActivateDragger);\n\n    const setState = (name, value) => {\n      this.setState({\n        [name]: value\n      });\n      return value;\n    };\n\n    const contextFactory = new ModelContextFactory();\n    this.modelContext = contextFactory.create(this.props.match);\n    await this.modelContext.initialize();\n    this.headerEventsConnection.changeEnableProperties.next(this.modelContext.getHaveProperties());\n    this.odaApp = await ClientFactory.get().createViewer({\n      target: canvas,\n      visualizeJsUrl: this.props.config.data.visualizejs_url,\n      onprogress: ev => this.setState({\n        visualizeProgress: 100 * ev.loaded / ev.total | 0\n      })\n    });\n    this.setState({\n      visualizeProgress: null\n    });\n    this.odaApp.addEventListener(\"ChangeWalkDraggerSpeed\", speed => {\n      this.props.addNotification(\"success\", `Move speed ${speed.data}`);\n    });\n    this.odaApp.addEventListener(\"select\", async ev => {\n      const sSet = ev.data;\n      const itr = sSet.getIterator();\n\n      if (!itr.done()) {\n        const entityId = itr.getEntity();\n        let handle = -1;\n\n        if (entityId.getType() === 1) {\n          handle = entityId.openObject().getNativeDatabaseHandle();\n        } else if (entityId.getType() === 2) {\n          handle = entityId.openObjectAsInsert().getNativeDatabaseHandle();\n        }\n\n        if (this.modelContext.getHaveProperties()) {\n          await this.getProperties(handle);\n        }\n      }\n    });\n    this.props.setVisualizeJS(this.odaApp.visLib());\n    setState(\"viewer\", this.odaApp.visViewer());\n    this.odaApp.visViewer().setExperimentalFunctionalityFlag(\"gpu_select\", false);\n    const models = setState(\"modelList\", await this.modelContext.getModels());\n    this.headerEventsConnection.changeModelList.next(models);\n    await this.openModel(models.find(model => model.default) || models[0]);\n  }\n\n  render() {\n    const fileInfo = this.modelContext && this.modelContext.get() || {};\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        minWidth: \"100%\",\n        height: \"100%\",\n        position: \"absolute\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        overflow: \"hidden\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        fileInfo: fileInfo,\n        children: /*#__PURE__*/_jsxDEV(UserMenu, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 496,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 495,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(ProgressBar, {\n          progress: this.state.geometryProgress * 100\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 499,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 498,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          minWidth: \"100%\",\n          height: \"100%\",\n          display: \"flex\",\n          flexDirection: \"column\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(HeaderComponent, {\n          isAssembly: this.props.match.params.assemblyId,\n          eventsConnection: this.headerEventsConnection\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 511,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: \"100%\",\n            height: \"100%\",\n            boxSizing: \"border-box\",\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              height: \"100%\",\n              display: \"flex\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n              id: \"canvas\",\n              className: this.state.canvasClassName,\n              style: {\n                width: \"100%\",\n                height: \"100%\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 525,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 524,\n            columnNumber: 13\n          }, this), this.state.visualizeProgress && /*#__PURE__*/_jsxDEV(VisualizeProgress, {\n            value: this.state.visualizeProgress\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 532,\n            columnNumber: 46\n          }, this), /*#__PURE__*/_jsxDEV(DraggerComponent, {\n            eventsConnection: this.draggerEventsConnection\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 534,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ViewActionComponent, {\n            eventsConnection: this.viewActionEvents\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 536,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ContextMenu, {\n            eventsConnection: this.contextMenuEvents\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 538,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 503,\n        columnNumber: 9\n      }, this), this.state.isLoadIndicatorVisible ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"absolute\",\n          top: \"calc(50% - 100px)\",\n          left: \"calc(50% - 100px)\",\n          width: \"200px\",\n          height: \"200px\",\n          color: \"#05093B\"\n        },\n        className: \"spinner-border\",\n        role: \"status\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 543,\n        columnNumber: 11\n      }, this) : null, this.state.isVisibleObjectExplorer ? /*#__PURE__*/_jsxDEV(ObjectExplorer, {\n        lib: this.odaApp.visLib(),\n        viewer: this.odaApp.visViewer(),\n        cda: this.state.isCDA,\n        getProperties: this.getProperties,\n        onClose: this.toggle(\"isVisibleObjectExplorer\")\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 558,\n        columnNumber: 11\n      }, this) : null, this.state.isVisibleProperties ? /*#__PURE__*/_jsxDEV(PropertiesComponent, {\n        eventsConnection: this.propertiesEvents\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 566,\n        columnNumber: 43\n      }, this) : null, this.state.isVisibleViewPointView ? /*#__PURE__*/_jsxDEV(ViewpointListComponent, {\n        eventsConnection: this.viewpointListEvents\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 568,\n        columnNumber: 11\n      }, this) : null, this.state.isVisibleTransformView ? /*#__PURE__*/_jsxDEV(AssemblyTransformComponent, {\n        viewer: this.odaApp,\n        assembly: this.modelContext.get(),\n        onClose: this.toggle(\"isVisibleTransformView\")\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 571,\n        columnNumber: 11\n      }, this) : null, this.state.isWalkHelperComponent ? /*#__PURE__*/_jsxDEV(WalkHelperComponent, {\n        onClose: this.toggle(\"isWalkHelperComponent\")\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 578,\n        columnNumber: 11\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 485,\n      columnNumber: 7\n    }, this);\n  }\n\n  componentWillUnmount() {\n    const canvas = document.getElementById(\"canvas\");\n    canvas.removeEventListener(\"mousedown\", this.changeCursorWhenDrag);\n    canvas.removeEventListener(\"mouseup\", this.changeCursorWhenActivateDragger);\n\n    if (this.odaApp) {\n      this.odaApp.cancel();\n      this.odaApp.dispose();\n    }\n\n    this.subscribeSubjectContext.unsubscribe();\n  }\n\n}\n\nexport default connect(state => ({ ...state,\n  openCloud: state.login.data.openCloud\n}), dispatch => ({\n  addNotification: (type, text) => dispatch(notification.addNotification(type, text)),\n  setVisualizeJS: visualizeJS => dispatch(actions.setVisualizeJS(visualizeJS)),\n  applySettings: () => dispatch(actions.applySettings())\n}))(withRouter(Viewer));","map":{"version":3,"sources":["/Users/yutianjian/test/oda/src/viewer/ViewerPage.js"],"names":["React","Component","connect","withRouter","actions","notification","ProgressBar","Header","UserMenu","VisualizeProgress","ClientFactory","ViewPointHelper","DraggerComponent","DraggerComponentEvent","ViewActionComponentEvent","ViewActionComponent","HeaderComponent","HeaderComponentEvent","ViewpointListEvent","ViewpointListComponent","PropertiesComponent","PropertiesEvent","ContextMenu","ContextMenuEvent","ObjectExplorer","SubscribeSubjectContext","ModelContextFactory","AssemblyTransformComponent","WalkHelperComponent","defaultState","modelList","activeModel","file","geometryProgress","visualizeProgress","databaseLoaded","isVisibleObjectExplorer","isVisibleProperties","isVisibleViewPointView","isVisibleTransformView","geometryLoaded","isCDA","isLoadIndicatorVisible","canvasClassName","activeDraggerName","isWalkHelperComponent","Viewer","constructor","props","state","isInitialize","defaultVisualStyle","odaApp","modelContext","toggle","name","setState","resetVisualStyleInformation","viewActionEvents","changeDefaultVisualStyle","next","visViewer","getActiveVisualStyle","changeCursorWhenDrag","changeCursorWhenActivateDragger","getProperties","handle","propertiesEvents","loadingProperties","getPropertiesByHandle","completeLoadProperties","lastProperties","e","openModel","model","cancel","unselect","draggerEventsConnection","changeInitialization","changeEnable","headerEventsConnection","changeSupportViewPoint","isSupportViewPoint","changeSupportTransform","isSupportTransform","loadReferences","displayObjectExplorer","properties","settings","progress","event","data","databaseChunk","addEventListener","open","removeEventListener","itr","getCDATreeIterator","changeEnableObjectExplorer","done","getConfig","cda","setEnableSceneGraph","extFile","getExtension","setBackgroundColor","ext","getActiveExtents","min","max","extHeight","change3dMode","err","console","error","subscribeSubjectContext","connectDraggerComponentEvents","connectViewActionComponentEvents","connectHeaderComponentEvents","connectViewpointListComponentEvents","connectPropertiesEvents","subscribe","onClose","viewpointListEvents","onRemoveViewpoint","vp","deleteViewpoint","guid","addNotification","onSelectViewpoint","viewpointModelId","custom_fields","modelId","viewPointPlugin","visLib","undefined","id","find","drawViewPoint","onOpenModel","onOpenObjectExplorer","onOpenProperties","setTimeout","onOpenViewpointView","viewPoints","getViewpoints","changeViewpoints","snapshot","getSnapshot","modifyViewpoint","onOpenEdit","changeVisibleForHelp","changeEnableHelp","onActivateDraggerByName","draggerName","setActiveDragger","onClearViewPoint","clearSlices","clearOverlay","onSaveViewPoint","getViewPoint","canvas","description","Date","toDateString","newVp","saveViewpoint","addViewpoint","explodeIndex","contextMenuEvents","execWithLoadIndicator","cb","onChangeVisualStyle","setActiveVisualStyle","onChangeViewType","type","defViewPos","DefaultViewPosition","setDefaultViewPositionWithAnimation","onChangeViewToDefaultValue","zoomExtents","onUnselect","onIsolateSelectedObjects","isolateSelectedObjects","onHideSelectedObjects","hideSelectedObjects","onShowAll","unisolateSelectedObjects","onExplode","explode","onCollect","onRegeneration","regenAll","onCreatePreview","base64Img","toDataURL","item","get","preview","save","onHelp","componentDidMount","document","getElementById","value","contextFactory","create","match","initialize","changeEnableProperties","getHaveProperties","createViewer","target","visualizeJsUrl","config","visualizejs_url","onprogress","ev","loaded","total","speed","sSet","getIterator","entityId","getEntity","getType","openObject","getNativeDatabaseHandle","openObjectAsInsert","setVisualizeJS","setExperimentalFunctionalityFlag","models","getModels","changeModelList","default","render","fileInfo","minWidth","height","position","display","flexDirection","overflow","params","assemblyId","width","boxSizing","top","left","color","componentWillUnmount","dispose","unsubscribe","openCloud","login","dispatch","text","visualizeJS","applySettings"],"mappings":"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","sourcesContent":["///////////////////////////////////////////////////////////////////////////////\n// Copyright (C) 2002-2021, Open Design Alliance (the \"Alliance\").\n// All rights reserved.\n//\n// This software and its documentation and related materials are owned by\n// the Alliance. The software may only be incorporated into application\n// programs owned by members of the Alliance, subject to a signed\n// Membership Agreement and Supplemental Software License Agreement with the\n// Alliance. The structure and organization of this software are the valuable\n// trade secrets of the Alliance and its suppliers. The software is also\n// protected by copyright law and international treaty provisions. Application\n// programs incorporating this software must include the following statement\n// with their copyright notices:\n//\n//   This application incorporates Open Design Alliance software pursuant to a\n//   license agreement with Open Design Alliance.\n//   Open Design Alliance Copyright (C) 2002-2021 by Open Design Alliance.\n//   All rights reserved.\n//\n// By use of this software, its documentation or related materials, you\n// acknowledge and accept the above terms.\n///////////////////////////////////////////////////////////////////////////////\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router\";\nimport { actions as notification } from \"../redux/notification\";\nimport { actions } from \"../redux/viewer\";\n\nimport ProgressBar from \"../components/ProgressBar\";\nimport Header from \"../components/Header\";\nimport UserMenu from \"../containers/UserMenu\";\n\nimport { VisualizeProgress } from \"./VisualizeJSProgress\";\nimport ClientFactory from \"../ClientFactory\";\n\nimport ViewPointHelper from \"./ViewPointHelper\";\n\nimport { DraggerComponent } from \"./DraggerComponent/DraggerComponent\";\nimport { DraggerComponentEvent } from \"./DraggerComponent/DraggerComponentEvent\";\n\nimport { ViewActionComponentEvent } from \"./ViewActionComponent/ViewActionComponentEvent\";\nimport { ViewActionComponent } from \"./ViewActionComponent/ViewActionComponent\";\n\nimport { HeaderComponent } from \"./HeaderComponent/HeaderComponent\";\nimport { HeaderComponentEvent } from \"./HeaderComponent/HeaderComponentEvent\";\n\nimport { ViewpointListEvent } from \"./ViewpointListComponent/ViewpointListEvent\";\nimport { ViewpointListComponent } from \"./ViewpointListComponent/ViewpointListComponent\";\n\nimport { PropertiesComponent } from \"./PropertiesComponent/PropertiesComponent\";\nimport { PropertiesEvent } from \"./PropertiesComponent/PropertiesEvent\";\n\nimport { ContextMenu } from \"./ContextMenu/ContextMenu\";\nimport { ContextMenuEvent } from \"./ContextMenu/ContextMenuEvent\";\n\nimport ObjectExplorer from \"./ObjectExplorer\";\n\nimport { SubscribeSubjectContext } from \"../utils/SubscribeSubjectContext\";\nimport { ModelContextFactory } from \"./ModelContexts/ModelContextFactory\";\n\nimport { AssemblyTransformComponent } from \"./AssemblyTransformComponent/AssemblyTransformComponent\";\n\nimport { WalkHelperComponent } from \"./WalkHelperComponent/WalkHelperComponent\";\n\nconst defaultState = {\n  modelList: [],\n  activeModel: null,\n  file: null,\n  geometryProgress: 0,\n  visualizeProgress: 0,\n  databaseLoaded: false,\n\n  isVisibleObjectExplorer: false,\n  isVisibleProperties: false,\n  isVisibleViewPointView: false,\n  isVisibleTransformView: false,\n\n  geometryLoaded: false,\n  isCDA: false,\n  isLoadIndicatorVisible: false,\n  canvasClassName: \"default-cursor\",\n  activeDraggerName: \"\",\n  isWalkHelperComponent: false,\n};\n\nclass Viewer extends Component {\n  state = { ...defaultState };\n\n  isInitialize = null;\n  defaultVisualStyle = \"\";\n  odaApp = null;\n  modelContext = null;\n\n  constructor(props) {\n    super(props);\n    this.subscribeSubjectContext = new SubscribeSubjectContext();\n    this.connectDraggerComponentEvents();\n    this.connectViewActionComponentEvents();\n    this.connectHeaderComponentEvents();\n    this.connectViewpointListComponentEvents();\n    this.connectPropertiesEvents();\n  }\n\n  toggle = (name) => () => this.setState({ [name]: !this.state[name] });\n\n  connectPropertiesEvents() {\n    this.propertiesEvents = new PropertiesEvent();\n    this.subscribeSubjectContext.subscribe(this.propertiesEvents.onClose, () => this.toggle(\"isVisibleProperties\")());\n  }\n\n  connectViewpointListComponentEvents() {\n    this.viewpointListEvents = new ViewpointListEvent();\n\n    this.subscribeSubjectContext.subscribe(this.viewpointListEvents.onClose, () =>\n      this.toggle(\"isVisibleViewPointView\")()\n    );\n    this.subscribeSubjectContext.subscribe(this.viewpointListEvents.onRemoveViewpoint, async (vp) => {\n      try {\n        await this.state.activeModel.deleteViewpoint(vp.guid);\n        this.props.addNotification(\"success\", \"Viewpoint deleted successfully\");\n      } catch (e) {\n        this.props.addNotification(\"error\", \"Error delete view point\");\n      }\n    });\n\n    this.subscribeSubjectContext.subscribe(this.viewpointListEvents.onSelectViewpoint, async (vp) => {\n      const viewpointModelId = vp.custom_fields && vp.custom_fields.modelId;\n      const viewPointPlugin = new ViewPointHelper(this.odaApp.visLib());\n\n      if (viewpointModelId !== undefined && this.state.activeModel && this.state.activeModel.id !== viewpointModelId) {\n        const model = this.state.modelList.find((model) => model.id === viewpointModelId);\n        if (model) {\n          try {\n            await this.openModel(model);\n            viewPointPlugin.drawViewPoint(vp);\n          } catch {\n            this.props.addNotification(\"error\", \"Cannot open model\");\n          }\n        }\n      } else {\n        viewPointPlugin.drawViewPoint(vp);\n      }\n    });\n  }\n\n  connectHeaderComponentEvents() {\n    this.headerEventsConnection = new HeaderComponentEvent();\n\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenModel, (model) => this.openModel(model));\n\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenObjectExplorer, () =>\n      this.toggle(\"isVisibleObjectExplorer\")()\n    );\n\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenProperties, () => {\n      this.toggle(\"isVisibleProperties\")();\n      if (this.lastProperties) {\n        setTimeout(() => {\n          this.propertiesEvents.completeLoadProperties.next(this.lastProperties);\n        }, 0);\n      }\n    });\n\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenViewpointView, async () => {\n      this.setState({ isVisibleViewPointView: true });\n\n      const viewPoints = await this.state.activeModel.getViewpoints();\n      this.viewpointListEvents.changeViewpoints.next(viewPoints);\n\n      for (let vp of viewPoints) {\n        if (!vp.snapshot) {\n          vp.snapshot = await this.state.activeModel.getSnapshot(vp.guid);\n          this.viewpointListEvents.modifyViewpoint.next(vp);\n        }\n      }\n    });\n    this.subscribeSubjectContext.subscribe(this.headerEventsConnection.onOpenEdit, () => {\n      this.setState({ isVisibleTransformView: true });\n    });\n  }\n\n  changeVisibleForHelp() {\n    if (this.state.activeDraggerName === \"Walk\") {\n      this.viewActionEvents.changeEnableHelp.next(true);\n    } else {\n      this.viewActionEvents.changeEnableHelp.next(false);\n    }\n  }\n\n  connectDraggerComponentEvents() {\n    this.draggerEventsConnection = new DraggerComponentEvent();\n    this.subscribeSubjectContext.subscribe(this.draggerEventsConnection.onActivateDraggerByName, (draggerName) => {\n      this.setState({ activeDraggerName: draggerName }, () => {\n        this.changeCursorWhenActivateDragger();\n        this.changeVisibleForHelp();\n      });\n\n      this.odaApp.setActiveDragger(draggerName);\n    });\n\n    this.subscribeSubjectContext.subscribe(this.draggerEventsConnection.onClearViewPoint, () => {\n      this.odaApp.clearSlices();\n      this.odaApp.clearOverlay();\n    });\n\n    this.subscribeSubjectContext.subscribe(this.draggerEventsConnection.onSaveViewPoint, async () => {\n      const viewPointPlugin = new ViewPointHelper(this.odaApp.visLib());\n      const vp = viewPointPlugin.getViewPoint(this.odaApp.visLib().canvas);\n\n      !vp.custom_fields && (vp.custom_fields = {});\n      this.state.activeModel && (vp.custom_fields.modelId = this.state.activeModel.id);\n\n      vp.description = new Date().toDateString();\n      let newVp = null;\n      try {\n        newVp = await this.state.activeModel.saveViewpoint(vp);\n        this.props.addNotification(\"success\", \"Viewpoint saved successfully\");\n      } catch (e) {\n        this.props.addNotification(\"error\", \"Error save view point\");\n      }\n\n      if (this.state.isVisibleViewPointView && newVp) {\n        if (!newVp.snapshot) {\n          newVp.snapshot = await this.state.activeModel.getSnapshot(newVp.guid);\n        }\n        this.viewpointListEvents.addViewpoint.next(newVp);\n      }\n    });\n  }\n\n  connectViewActionComponentEvents() {\n    this.explodeIndex = 1;\n    this.viewActionEvents = new ViewActionComponentEvent();\n    this.contextMenuEvents = new ContextMenuEvent();\n\n    const execWithLoadIndicator = (cb) => {\n      this.setState({ isLoadIndicatorVisible: true }, () => {\n        setTimeout(() => {\n          cb();\n          this.setState({ isLoadIndicatorVisible: false });\n        }, 10);\n      });\n    };\n\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onChangeVisualStyle, (name) => {\n      execWithLoadIndicator(() => this.odaApp.visViewer().setActiveVisualStyle(name));\n    });\n\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onChangeViewType, (type) => {\n      const defViewPos = this.odaApp.visLib().DefaultViewPosition;\n      this.odaApp.visViewer().setDefaultViewPositionWithAnimation(defViewPos[type]);\n    });\n\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onChangeViewToDefaultValue, () =>\n      this.odaApp.visViewer().zoomExtents()\n    );\n\n    const onUnselect = () => execWithLoadIndicator(() => this.odaApp.visViewer().unselect());\n    const onIsolateSelectedObjects = () =>\n      execWithLoadIndicator(() => this.odaApp.visViewer().isolateSelectedObjects(false));\n    const onHideSelectedObjects = () => execWithLoadIndicator(() => this.odaApp.visViewer().hideSelectedObjects());\n    const onShowAll = () => execWithLoadIndicator(() => this.odaApp.visViewer().unisolateSelectedObjects(false));\n\n    const onExplode = () =>\n      execWithLoadIndicator(() => {\n        this.explodeIndex++;\n        this.odaApp.visViewer().explode(this.explodeIndex);\n      });\n\n    const onCollect = () =>\n      execWithLoadIndicator(() => {\n        this.explodeIndex = 1;\n        this.odaApp.visViewer().explode(1);\n      });\n\n    const onRegeneration = () =>\n      execWithLoadIndicator(() => {\n        this.odaApp.visViewer().regenAll();\n      });\n\n    const onCreatePreview = async () => {\n      const canvas = this.odaApp.visLib().canvas;\n      const base64Img = canvas.toDataURL(\"image/jpeg\", 0.25);\n\n      const item = this.modelContext.get();\n\n      item.preview = base64Img;\n      item.save();\n\n      this.props.addNotification(\"success\", \"Update file preview done\");\n    };\n\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onUnselect, onUnselect);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onIsolateSelectedObjects, onIsolateSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onHideSelectedObjects, onHideSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onShowAll, onShowAll);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onExplode, onExplode);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onCollect, onCollect);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onRegeneration, onRegeneration);\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onCreatePreview, onCreatePreview);\n\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onUnselect, onUnselect);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onIsolateSelectedObjects, onIsolateSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onHideSelectedObjects, onHideSelectedObjects);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onShowAll, onShowAll);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onExplode, onExplode);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onCollect, onCollect);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onRegeneration, onRegeneration);\n    this.subscribeSubjectContext.subscribe(this.contextMenuEvents.onCreatePreview, onCreatePreview);\n\n    this.subscribeSubjectContext.subscribe(this.viewActionEvents.onHelp, () => {\n      this.setState({ isWalkHelperComponent: true });\n    });\n  }\n\n  resetVisualStyleInformation = () => {\n    this.viewActionEvents.changeDefaultVisualStyle.next(this.odaApp.visViewer().getActiveVisualStyle());\n  };\n\n  changeCursorWhenDrag = () => {\n    if (this.state.activeDraggerName === \"Pan\") {\n      this.setState({ canvasClassName: \"pan-active-cursor\" });\n    } else if (this.state.activeDraggerName === \"Orbit\") {\n      this.setState({ canvasClassName: \"orbit-active-cursor\" });\n    } else {\n      this.setState({ canvasClassName: \"default-cursor\" });\n    }\n  };\n\n  changeCursorWhenActivateDragger = () => {\n    if (this.state.activeDraggerName === \"Pan\") {\n      this.setState({ canvasClassName: \"pan-cursor\" });\n    } else if (this.state.activeDraggerName === \"Orbit\") {\n      this.setState({ canvasClassName: \"orbit-cursor\" });\n    } else {\n      this.setState({ canvasClassName: \"default-cursor\" });\n    }\n  };\n\n  async componentDidMount() {\n    const canvas = document.getElementById(\"canvas\");\n    canvas.addEventListener(\"mousedown\", this.changeCursorWhenDrag);\n    canvas.addEventListener(\"mouseup\", this.changeCursorWhenActivateDragger);\n\n    const setState = (name, value) => {\n      this.setState({ [name]: value });\n      return value;\n    };\n\n    const contextFactory = new ModelContextFactory();\n    this.modelContext = contextFactory.create(this.props.match);\n\n    await this.modelContext.initialize();\n\n    this.headerEventsConnection.changeEnableProperties.next(this.modelContext.getHaveProperties());\n\n    this.odaApp = await ClientFactory.get().createViewer({\n      target: canvas,\n      visualizeJsUrl: this.props.config.data.visualizejs_url,\n      onprogress: (ev) =>\n        this.setState({\n          visualizeProgress: ((100 * ev.loaded) / ev.total) | 0,\n        }),\n    });\n    this.setState({ visualizeProgress: null });\n\n    this.odaApp.addEventListener(\"ChangeWalkDraggerSpeed\", (speed) => {\n      this.props.addNotification(\"success\", `Move speed ${speed.data}`);\n    });\n\n    this.odaApp.addEventListener(\"select\", async (ev) => {\n      const sSet = ev.data;\n      const itr = sSet.getIterator();\n      if (!itr.done()) {\n        const entityId = itr.getEntity();\n        let handle = -1;\n        if (entityId.getType() === 1) {\n          handle = entityId.openObject().getNativeDatabaseHandle();\n        } else if (entityId.getType() === 2) {\n          handle = entityId.openObjectAsInsert().getNativeDatabaseHandle();\n        }\n        if (this.modelContext.getHaveProperties()) {\n          await this.getProperties(handle);\n        }\n      }\n    });\n\n    this.props.setVisualizeJS(this.odaApp.visLib());\n    setState(\"viewer\", this.odaApp.visViewer());\n\n    this.odaApp.visViewer().setExperimentalFunctionalityFlag(\"gpu_select\", false);\n    const models = setState(\"modelList\", await this.modelContext.getModels());\n\n    this.headerEventsConnection.changeModelList.next(models);\n\n    await this.openModel(models.find((model) => model.default) || models[0]);\n  }\n\n  getProperties = async (handle) => {\n    try {\n      this.propertiesEvents.loadingProperties.next(true);\n      const props = await this.modelContext.getPropertiesByHandle(handle);\n      if (this.state.isVisibleProperties) {\n        this.propertiesEvents.completeLoadProperties.next(props);\n        this.lastProperties = null;\n      } else {\n        this.lastProperties = props;\n      }\n    } catch (e) {\n      this.propertiesEvents.loadingProperties.next(\"Not found properties\");\n    }\n  };\n\n  openModel = async (model) => {\n    try {\n      if (this.odaApp) {\n        this.odaApp.cancel();\n        this.odaApp.visViewer().unselect();\n      }\n\n      this.draggerEventsConnection.changeInitialization.next();\n      this.viewActionEvents.changeEnable.next(false);\n      this.headerEventsConnection.changeEnable.next(false);\n      this.draggerEventsConnection.changeSupportViewPoint.next(this.modelContext.isSupportViewPoint());\n      this.headerEventsConnection.changeSupportViewPoint.next(this.modelContext.isSupportViewPoint());\n      this.headerEventsConnection.changeSupportTransform.next(this.modelContext.isSupportTransform());\n\n      await this.odaApp.loadReferences(model);\n\n      this.setState({\n        activeModel: model,\n        displayObjectExplorer: false,\n        properties: false,\n        settings: false,\n      });\n\n      const progress = (event) => this.setState({ geometryProgress: event.data });\n      const databaseChunk = () => {\n        this.setState({ databaseLoaded: true });\n\n        this.draggerEventsConnection.changeEnable.next(true);\n        this.viewActionEvents.changeEnable.next(true);\n        this.headerEventsConnection.changeEnable.next(true);\n\n        this.resetVisualStyleInformation();\n      };\n\n      this.odaApp.addEventListener(\"geometry-progress\", progress);\n      this.odaApp.addEventListener(\"database-chunk\", databaseChunk);\n\n      await this.odaApp.open(model);\n\n      this.odaApp.removeEventListener(\"database-chunk\", databaseChunk);\n      this.odaApp.removeEventListener(\"geometry-progress\", progress);\n\n      {\n        const itr = this.odaApp.visViewer().getCDATreeIterator();\n        this.headerEventsConnection.changeEnableObjectExplorer.next(!itr.done());\n        this.setState({\n          geometryLoaded: true,\n          isCDA: !itr.done() && ClientFactory.getConfig().cda,\n        });\n      }\n\n      this.odaApp.visViewer().setEnableSceneGraph(true);\n\n      const extFile = this.modelContext.getExtension();\n      if (extFile === \".obj\" || extFile === \".ifc\") this.odaApp.visViewer().setBackgroundColor([255, 255, 255]);\n\n      const ext = this.odaApp.visViewer().getActiveExtents();\n      const min = ext.min();\n      const max = ext.max();\n      const extHeight = max[2] - min[2];\n\n      this.draggerEventsConnection.change3dMode.next(extHeight !== 0);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  render() {\n    const fileInfo = (this.modelContext && this.modelContext.get()) || {};\n\n    return (\n      <div\n        style={{\n          minWidth: \"100%\",\n          height: \"100%\",\n          position: \"absolute\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          overflow: \"hidden\",\n        }}\n      >\n        <Header fileInfo={fileInfo}>\n          <UserMenu></UserMenu>\n        </Header>\n        <div>\n          <ProgressBar progress={this.state.geometryProgress * 100} />\n        </div>\n\n        {/* Content */}\n        <div\n          style={{\n            minWidth: \"100%\",\n            height: \"100%\",\n            display: \"flex\",\n            flexDirection: \"column\",\n          }}\n        >\n          <HeaderComponent\n            isAssembly={this.props.match.params.assemblyId}\n            eventsConnection={this.headerEventsConnection}\n          />\n\n          <div\n            style={{\n              width: \"100%\",\n              height: \"100%\",\n              boxSizing: \"border-box\",\n              overflow: \"hidden\",\n            }}\n          >\n            <div style={{ height: \"100%\", display: \"flex\" }}>\n              <canvas\n                id=\"canvas\"\n                className={this.state.canvasClassName}\n                style={{ width: \"100%\", height: \"100%\" }}\n              ></canvas>\n            </div>\n\n            {this.state.visualizeProgress && <VisualizeProgress value={this.state.visualizeProgress} />}\n\n            <DraggerComponent eventsConnection={this.draggerEventsConnection}></DraggerComponent>\n\n            <ViewActionComponent eventsConnection={this.viewActionEvents}></ViewActionComponent>\n\n            <ContextMenu eventsConnection={this.contextMenuEvents}></ContextMenu>\n          </div>\n        </div>\n\n        {this.state.isLoadIndicatorVisible ? (\n          <div\n            style={{\n              position: \"absolute\",\n              top: \"calc(50% - 100px)\",\n              left: \"calc(50% - 100px)\",\n              width: \"200px\",\n              height: \"200px\",\n              color: \"#05093B\",\n            }}\n            className=\"spinner-border\"\n            role=\"status\"\n          ></div>\n        ) : null}\n\n        {this.state.isVisibleObjectExplorer ? (\n          <ObjectExplorer\n            lib={this.odaApp.visLib()}\n            viewer={this.odaApp.visViewer()}\n            cda={this.state.isCDA}\n            getProperties={this.getProperties}\n            onClose={this.toggle(\"isVisibleObjectExplorer\")}\n          />\n        ) : null}\n        {this.state.isVisibleProperties ? <PropertiesComponent eventsConnection={this.propertiesEvents} /> : null}\n        {this.state.isVisibleViewPointView ? (\n          <ViewpointListComponent eventsConnection={this.viewpointListEvents} />\n        ) : null}\n        {this.state.isVisibleTransformView ? (\n          <AssemblyTransformComponent\n            viewer={this.odaApp}\n            assembly={this.modelContext.get()}\n            onClose={this.toggle(\"isVisibleTransformView\")}\n          ></AssemblyTransformComponent>\n        ) : null}\n        {this.state.isWalkHelperComponent ? (\n          <WalkHelperComponent onClose={this.toggle(\"isWalkHelperComponent\")}></WalkHelperComponent>\n        ) : null}\n      </div>\n    );\n  }\n\n  componentWillUnmount() {\n    const canvas = document.getElementById(\"canvas\");\n    canvas.removeEventListener(\"mousedown\", this.changeCursorWhenDrag);\n    canvas.removeEventListener(\"mouseup\", this.changeCursorWhenActivateDragger);\n    if (this.odaApp) {\n      this.odaApp.cancel();\n      this.odaApp.dispose();\n    }\n    this.subscribeSubjectContext.unsubscribe();\n  }\n}\n\nexport default connect(\n  (state) => ({ ...state, openCloud: state.login.data.openCloud }),\n  (dispatch) => ({\n    addNotification: (type, text) => dispatch(notification.addNotification(type, text)),\n    setVisualizeJS: (visualizeJS) => dispatch(actions.setVisualizeJS(visualizeJS)),\n    applySettings: () => dispatch(actions.applySettings()),\n  })\n)(withRouter(Viewer));\n"]},"metadata":{},"sourceType":"module"}